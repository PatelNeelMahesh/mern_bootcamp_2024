# Joins

## **1. What Are Joins in DBMS?**

In **Relational Databases (RDBMS)**, **joins** are used to:

* **Combine data** from two or more tables,
* Based on a **related column** between them (usually a key).

For example:

* You might have a `students` table and a `courses` table,
* and you want to display which student is enrolled in which course — that’s done through a **JOIN**.

---

## **2. Example Database (We’ll Use Throughout)**

Let’s take two tables:

### **Table 1: Students**

| student_id | name   | city      |
| ---------- | ------ | --------- |
| 1          | Arjun  | Ahmedabad |
| 2          | Yashvi | Surat     |
| 3          | Mahir  | Vadodara  |

### **Table 2: Enrollments**

| enroll_id | student_id | course       |
| --------- | ---------- | ------------ |
| 201       | 1          | Web Dev      |
| 202       | 2          | AI & ML      |
| 203       | 4          | Data Science |

Notice that:

* `Enrollments.student_id` refers to `Students.student_id`
* But `student_id = 4` doesn’t exist in Students — this helps us understand joins properly.

---

## **3. Types of Joins in DBMS**

We’ll cover all major joins:

1. INNER JOIN
2. LEFT JOIN (LEFT OUTER JOIN)
3. RIGHT JOIN (RIGHT OUTER JOIN)
4. FULL JOIN (FULL OUTER JOIN)
5. CROSS JOIN
6. SELF JOIN

Then we’ll map each to **MongoDB `$lookup`** or **aggregation** equivalents.

---

### **3.1 INNER JOIN**

#### **Definition:**

Returns **only the records** that have **matching values** in both tables.

#### **SQL Example:**

```sql
SELECT s.student_id, s.name, e.course
FROM Students s
INNER JOIN Enrollments e
ON s.student_id = e.student_id;
```

#### **Result:**

| student_id | name   | course  |
| ---------- | ------ | ------- |
| 1          | Arjun  | Web Dev |
| 2          | Yashvi | AI & ML |

**Explanation:**

* Only records where `student_id` exists in **both** tables are shown.
* Student `Mahir` has no enrollment, and `student_id=4` in Enrollments doesn’t exist in Students.

---

#### **MongoDB Equivalent: `$lookup`**

MongoDB doesn’t have joins natively (it’s NoSQL), but it supports **aggregation joins** using `$lookup`.

**Collections:**

```js
// students
{ "_id": 1, "name": "Arjun", "city": "Ahmedabad" }
{ "_id": 2, "name": "Yashvi", "city": "Surat" }
{ "_id": 3, "name": "Mahir", "city": "Vadodara" }

// enrollments
{ "_id": 201, "student_id": 1, "course": "Web Dev" }
{ "_id": 202, "student_id": 2, "course": "AI & ML" }
{ "_id": 203, "student_id": 4, "course": "Data Science" }
```

**Query:**

```js
db.students.aggregate([
  {
    $lookup: {
      from: "enrollments",
      localField: "_id",
      foreignField: "student_id",
      as: "enrollmentInfo"
    }
  },
  { $unwind: "$enrollmentInfo" } // acts like INNER JOIN
])
```

**Result:**

```json
[
  { "_id": 1, "name": "Arjun", "course": "Web Dev" },
  { "_id": 2, "name": "Yashvi", "course": "AI & ML" }
]
```

---

### **3.2 LEFT JOIN (LEFT OUTER JOIN)**

#### **Definition:**

Returns **all records from the left table**, and the **matched records** from the right table.
If no match, NULL values appear for right table columns.

#### **SQL Example:**

```sql
SELECT s.student_id, s.name, e.course
FROM Students s
LEFT JOIN Enrollments e
ON s.student_id = e.student_id;
```

#### **Result:**

| student_id | name   | course  |
| ---------- | ------ | ------- |
| 1          | Arjun  | Web Dev |
| 2          | Yashvi | AI & ML |
| 3          | Mahir  | NULL    |

**Explanation:**
All students are shown — even if they don’t have enrollments.

---

#### **MongoDB Equivalent: `$lookup` (without `$unwind`)**

```js
db.students.aggregate([
  {
    $lookup: {
      from: "enrollments",
      localField: "_id",
      foreignField: "student_id",
      as: "enrollmentInfo"
    }
  }
])
```

**Result:**

```json
[
  {
    "_id": 1,
    "name": "Arjun",
    "enrollmentInfo": [{ "course": "Web Dev" }]
  },
  {
    "_id": 2,
    "name": "Yashvi",
    "enrollmentInfo": [{ "course": "AI & ML" }]
  },
  {
    "_id": 3,
    "name": "Mahir",
    "enrollmentInfo": []
  }
]
```

Here, Mahir has an empty array because there’s no matching record — this mimics **LEFT JOIN** behavior.

---

### **3.3 RIGHT JOIN (RIGHT OUTER JOIN)**

#### **Definition:**

Returns **all records from the right table**, and the **matched records** from the left table.

#### **SQL Example:**

```sql
SELECT s.student_id, s.name, e.course
FROM Students s
RIGHT JOIN Enrollments e
ON s.student_id = e.student_id;
```

#### **Result:**

| student_id | name   | course       |
| ---------- | ------ | ------------ |
| 1          | Arjun  | Web Dev      |
| 2          | Yashvi | AI & ML      |
| 4          | NULL   | Data Science |

**Explanation:**
Shows all enrollments — even if no matching student exists.

---

#### **MongoDB Equivalent:**

MongoDB doesn’t directly support **RIGHT JOIN**, but we can **swap the collections** in `$lookup` to simulate it.

```js
db.enrollments.aggregate([
  {
    $lookup: {
      from: "students",
      localField: "student_id",
      foreignField: "_id",
      as: "studentInfo"
    }
  }
])
```

**Result:**

```json
[
  { "course": "Web Dev", "studentInfo": [{ "name": "Arjun" }] },
  { "course": "AI & ML", "studentInfo": [{ "name": "Yashvi" }] },
  { "course": "Data Science", "studentInfo": [] }
]
```

---

### **3.4 FULL JOIN (FULL OUTER JOIN)**

#### **Definition:**

Returns **all records** when there is a match in **either table**.
Unmatched records from both sides are shown with NULLs.

#### **SQL Example:**

```sql
SELECT s.student_id, s.name, e.course
FROM Students s
FULL OUTER JOIN Enrollments e
ON s.student_id = e.student_id;
```

#### **Result:**

| student_id | name   | course       |
| ---------- | ------ | ------------ |
| 1          | Arjun  | Web Dev      |
| 2          | Yashvi | AI & ML      |
| 3          | Mahir  | NULL         |
| 4          | NULL   | Data Science |

---

#### **MongoDB Equivalent:**

MongoDB doesn’t have a direct FULL JOIN, but it can be simulated using:

* `$lookup` (for LEFT JOIN)
* `$unionWith` (to merge both sides)

Example:

```js
// Left join
const left = db.students.aggregate([
  {
    $lookup: {
      from: "enrollments",
      localField: "_id",
      foreignField: "student_id",
      as: "enrollmentInfo"
    }
  }
]);

// Right join simulation using union
db.students.aggregate([
  {
    $lookup: {
      from: "enrollments",
      localField: "_id",
      foreignField: "student_id",
      as: "enrollmentInfo"
    }
  },
  {
    $unionWith: {
      coll: "enrollments",
      pipeline: [
        {
          $lookup: {
            from: "students",
            localField: "student_id",
            foreignField: "_id",
            as: "studentInfo"
          }
        }
      ]
    }
  }
]);
```

---

### **3.5 CROSS JOIN (Cartesian Product)**

#### **Definition:**

Returns **all combinations** of rows from both tables —
If you have 3 students and 3 enrollments, you get **9 rows**.

#### **SQL Example:**

```sql
SELECT s.name, e.course
FROM Students s
CROSS JOIN Enrollments e;
```

#### **Result:**

| name   | course       |
| ------ | ------------ |
| Arjun  | Web Dev      |
| Arjun  | AI & ML      |
| Arjun  | Data Science |
| Yashvi | Web Dev      |
| Yashvi | AI & ML      |
| Yashvi | Data Science |
| Mahir  | Web Dev      |
| Mahir  | AI & ML      |
| Mahir  | Data Science |
---

#### **MongoDB Equivalent:**

No direct cross join, but you can simulate it using `$lookup` with a condition that always matches (like joining everything):

```js
db.students.aggregate([
  {
    $lookup: {
      from: "enrollments",
      pipeline: [],
      as: "enrollmentInfo"
    }
  },
  { $unwind: "$enrollmentInfo" }
])
```

This will effectively return **every combination** of students and enrollments.

---

### **3.6 SELF JOIN**

#### **Definition:**

A table joined **with itself**, used to compare rows in the same table.

#### **SQL Example:**

```sql
SELECT s1.name AS student1, s2.name AS student2
FROM Students s1
JOIN Students s2
ON s1.city = s2.city
WHERE s1.student_id <> s2.student_id;
```

#### **Purpose:**

Find students from the **same city**.

---

#### **MongoDB Equivalent:**

MongoDB supports this using `$lookup` on the **same collection**.

```js
db.students.aggregate([
  {
    $lookup: {
      from: "students",
      localField: "city",
      foreignField: "city",
      as: "sameCityStudents"
    }
  },
  {
    $project: {
      name: 1,
      sameCityStudents: "$sameCityStudents.name"
    }
  }
])
```

---

## **4. Summary Table**

| **Join Type** | **SQL Definition**                     | **MongoDB Equivalent**        | **Example Purpose**                     |
| ------------- | -------------------------------------- | ----------------------------- | --------------------------------------- |
| INNER JOIN    | Returns records present in both tables | `$lookup` + `$unwind`         | Students with enrollments               |
| LEFT JOIN     | All from left + matches from right     | `$lookup`                     | All students (with/without enrollments) |
| RIGHT JOIN    | All from right + matches from left     | `$lookup` (swap collections)  | All enrollments (with/without student)  |
| FULL JOIN     | All records from both                  | `$lookup` + `$unionWith`      | Combined data even if no match          |
| CROSS JOIN    | All combinations                       | `$lookup` with empty pipeline | Cartesian product                       |
| SELF JOIN     | Join same collection                   | `$lookup` on same collection  | Students in same city                   |

---

## **5. Real-World Mapping Example**

At CodingGita:

* `students` collection stores student details.
* `courses` collection stores course details.
* `enrollments` collection maps which student joined which course.

You can easily use `$lookup` to:

* Display which students are enrolled in which course (**INNER JOIN**)
* Show all students even if not enrolled (**LEFT JOIN**)
* Or find those who enrolled in a course but whose student record was deleted (**RIGHT JOIN simulation**)

---
